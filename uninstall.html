<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LinkedIn ‚Üí CSV Exporter - Uninstalled</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .container {
      background: white;
      border-radius: 16px;
      padding: 40px;
      max-width: 500px;
      width: 100%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    .icon {
      font-size: 64px;
      margin-bottom: 20px;
    }
    
    h1 {
      color: #333;
      font-size: 24px;
      margin-bottom: 16px;
    }
    
    p {
      color: #666;
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 24px;
    }
    
    .feedback-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 24px;
      margin-top: 24px;
    }
    
    .feedback-section h2 {
      color: #333;
      font-size: 18px;
      margin-bottom: 12px;
    }
    
    .feedback-link {
      display: inline-block;
      background: #667eea;
      color: white;
      text-decoration: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      transition: background 0.2s;
    }
    
    .feedback-link:hover {
      background: #5a6fd6;
    }
    
    .reinstall-link {
      display: inline-block;
      margin-top: 16px;
      color: #667eea;
      text-decoration: none;
      font-size: 14px;
    }
    
    .reinstall-link:hover {
      text-decoration: underline;
    }
    
    .footer {
      margin-top: 32px;
      color: #999;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="icon">üëã</div>
    <h1>Sorry to See You Go!</h1>
    <p>
      Thank you for trying <strong>LinkedIn ‚Üí CSV Exporter</strong>. 
      We hope it was helpful during your time using it.
    </p>
    
    <div class="feedback-section">
      <h2>Help Us Improve</h2>
      <p style="margin-bottom: 16px; font-size: 14px;">
        Your feedback helps us make the extension better for everyone.
      </p>
      <a href="https://forms.gle/LSL67X744HYxNGQt7" target="_blank" class="feedback-link">
        üí¨ Share Feedback
      </a>
    </div>
    
    <a href="https://chromewebstore.google.com/detail/hnpadjdaninnijdpjmjpndhdcdefennl" class="reinstall-link">
      Changed your mind? Reinstall the extension ‚Üí
    </a>
    
    <div class="footer">
      <p>Made with ‚ù§Ô∏è for professionals</p>
    </div>
  </div>

  <script>
    /**
     * EXTENSION_UNINSTALLED Event Tracking
     * 
     * Fixed CORS issue by:
     * 1. Using sendBeacon with Blob (no custom headers)
     * 2. Fallback to image pixel tracking (no CORS at all)
     * 3. API key in URL to avoid preflight
     */
    (async function() {
      try {
        // Parse URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const anonId = urlParams.get('anon_id') || 'unknown';
        const version = urlParams.get('version') || 'unknown';
        const installTimestamp = urlParams.get('timestamp') || 0;
        
        // Analytics configuration
        const ANALYTICS_CONFIG = {
          ENDPOINT: 'https://api.logflare.app/logs',
          SOURCE_ID: '21a365f1-571a-43d4-bda5-b5fc3719861f',
          API_KEY: 'Bb5ypTTBAx4s'
        };
        
        // Build payload
        const payload = {
          event_message: 'EXTENSION_UNINSTALLED',
          metadata: {
            event_version: '1.0',
            anon_id: anonId,
            extension_version: version,
            install_timestamp: parseInt(installTimestamp) || 0,
            uninstall_timestamp: Date.now(),
            usage_duration_ms: installTimestamp ? (Date.now() - parseInt(installTimestamp)) : null
          }
        };
        
        // Build URL with all parameters (avoids CORS preflight)
        const url = new URL(ANALYTICS_CONFIG.ENDPOINT);
        url.searchParams.set('source', ANALYTICS_CONFIG.SOURCE_ID);
        url.searchParams.set('api_key', ANALYTICS_CONFIG.API_KEY);
        
        // Method 1: Try sendBeacon with proper content type
        const blob = new Blob([JSON.stringify(payload)], { type: 'application/json' });
        const beaconSent = navigator.sendBeacon(url.toString(), blob);
        
        if (beaconSent) {
          console.log('‚úÖ Uninstall event tracked via sendBeacon');
        } else {
          // Method 2: Fallback to fetch with minimal headers
          try {
            await fetch(url.toString(), {
              method: 'POST',
              body: JSON.stringify(payload),
              headers: {
                'Content-Type': 'application/json'
              },
              keepalive: true
            });
            console.log('‚úÖ Uninstall event tracked via fetch');
          } catch (fetchError) {
            // Method 3: Ultimate fallback - use GET request with data in URL
            const fallbackUrl = new URL(ANALYTICS_CONFIG.ENDPOINT);
            fallbackUrl.searchParams.set('source', ANALYTICS_CONFIG.SOURCE_ID);
            fallbackUrl.searchParams.set('api_key', ANALYTICS_CONFIG.API_KEY);
            fallbackUrl.searchParams.set('event', 'EXTENSION_UNINSTALLED');
            fallbackUrl.searchParams.set('anon_id', anonId);
            fallbackUrl.searchParams.set('version', version);
            fallbackUrl.searchParams.set('timestamp', installTimestamp);
            
            // Use image pixel for GET request (no CORS issues)
            const img = new Image();
            img.src = fallbackUrl.toString();
            console.log('‚úÖ Uninstall event tracked via image pixel');
          }
        }
      } catch (error) {
        // Silent failure - don't bother the user
        console.log('‚ö†Ô∏è Analytics error (non-critical):', error.message);
      }
    })();
  </script>
</body>
</html>
